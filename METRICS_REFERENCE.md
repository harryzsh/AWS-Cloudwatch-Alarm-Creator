# CloudWatch Metrics Reference

Complete list of all monitored metrics, thresholds, and alarm configurations.

**Last Updated:** February 2026

---

## Table of Contents

- [CloudWatch Metrics Reference](#cloudwatch-metrics-reference)
  - [Table of Contents](#table-of-contents)
  - [Tag-Based Alarms](#tag-based-alarms)
    - [EC2 Instances](#ec2-instances)
    - [NAT Gateway](#nat-gateway)
    - [VPN](#vpn)
  - [Resource-Based Alarms](#resource-based-alarms)
    - [MSK (Kafka)](#msk-kafka)
    - [ACM](#acm)
    - [Application Load Balancer (ALB)](#application-load-balancer-alb)
    - [Direct Connect](#direct-connect)
  - [Common Alarm Settings](#common-alarm-settings)
  - [References](#references)

---

## Tag-Based Alarms

Deployed via `cloudformation-tag-based-alarms.yaml`. Uses CloudWatch Metrics Insights SQL with tag filtering. All alarms use `_WARNING` suffix for future severity tier support.

**Total: 10 alarms**  
**Parameters (all required):** `--tag-key`, `--tag-value`, `--sns-topic`  
**Naming:** `{TagValue}-{Service}-{Metric}_WARNING`

### EC2 Instances

**Alarms:** 7  
**Namespaces:** `AWS/EC2`, `CWAgent`

| Metric | Namespace | Threshold | Operator | Description |
|--------|-----------|-----------|----------|-------------|
| CPUUtilization | AWS/EC2 | 90% | > | 服务器CPU使用率超过90% |
| mem_used_percent* | CWAgent | 90% | > | 服务器内存使用率超过90% |
| disk_used_percent* | CWAgent | 90% | > | 服务器磁盘使用率超过90% |
| disk_inodes_used_percent* | CWAgent | 90% | > | 服务器磁盘inode使用率超过90% |
| StatusCheckFailed_System | AWS/EC2 | 1 | >= | EC2系统状态检查失败 |
| StatusCheckFailed | AWS/EC2 | 1 | >= | EC2状态检查失败 |
| StatusCheckFailed_Instance | AWS/EC2 | 1 | >= | EC2实例状态检查失败 - 实例配置问题 |

*\* Requires [CloudWatch Agent](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Install-CloudWatch-Agent.html) installed on EC2 instances. Without it, alarms show INSUFFICIENT_DATA but do not trigger false alerts (`TreatMissingData: notBreaching`).*

### NAT Gateway

**Alarms:** 1  
**Namespace:** `AWS/NATGateway`

| Metric | Threshold | Operator | Description |
|--------|-----------|----------|-------------|
| ErrorPortAllocation | 100 | > | NAT网关端口分配错误超过100次 |

### VPN

**Alarms:** 2  
**Namespace:** `AWS/VPN`

| Metric | Dimensions | Threshold | Operator | Description |
|--------|------------|-----------|----------|-------------|
| TunnelState (connection) | VpnId | 1 | < | VPN连接隧道状态异常 - 连接级别 |
| TunnelState (tunnel) | VpnId, TunnelIpAddress | 1 | < | VPN隧道状态异常 - 隧道级别 |

---

## Resource-Based Alarms

Configured in `alarm-config-resource-based.yaml`, generated by `resource_alarm_builder.py`. Creates dedicated alarms per discovered resource. All alarms use `_WARNING` suffix for future severity tier support.

**Total: 10 alarm definitions** (multiplied by number of discovered resources)  
**Naming:** `{TagValue}-{Service}-{Resource}-{Metric}_WARNING`

### MSK (Kafka)

**Alarms per cluster:** 5  
**Namespace:** `AWS/Kafka`  
**Primary Dimension:** Cluster Name

| Metric | Extra Dimensions | Threshold | Operator | Type | Description |
|--------|-----------------|-----------|----------|------|-------------|
| MaxOffsetLag | Consumer Group, Topic | 200,000 | > | Standard | Kafka消费者组最大偏移延迟 |
| CpuUser | Broker ID | 90% | > | Standard | Kafka Broker CPU用户空间使用率 |
| MemoryPercent | Broker ID | 90% | > | Math† | Kafka Broker内存使用百分比 |
| KafkaDataLogsDiskUsed | Broker ID | 75% | > | Standard | Kafka数据日志磁盘使用率 |
| ActiveControllerCount | — | 1 | < | Standard | Kafka活跃控制器数量 |

†**Math Expression:** `m1/(m1+m2)*100` where m1=MemoryUsed, m2=MemoryFree

### ACM

**Alarms per certificate:** 1  
**Namespace:** `AWS/CertificateManager`  
**Primary Dimension:** CertificateArn

| Metric | Threshold | Operator | Description |
|--------|-----------|----------|-------------|
| DaysToExpiry | 30 days | <= | ACM证书到期天数 - 证书即将过期 |

### Application Load Balancer (ALB)

**Alarms per load balancer:** 1  
**Namespace:** `AWS/ApplicationELB`  
**Primary Dimension:** LoadBalancer

| Metric | Threshold | Operator | Description |
|--------|-----------|----------|-------------|
| UnHealthyHostCount | 1 | >= | ALB后端不健康主机数量大于等于1 |

### Direct Connect

**Alarms per connection:** 3  
**Namespace:** `AWS/DX`  
**Primary Dimension:** ConnectionId

| Metric | Threshold | Operator | Type | Description |
|--------|-----------|----------|------|-------------|
| ConnectionState | 1 | < | Standard | Direct Connect连接状态 - 连接断开 |
| IngressBandwidthPercent | 90% | > | Math† | Direct Connect入站带宽使用百分比 |
| EgressBandwidthPercent | 90% | > | Math† | Direct Connect出站带宽使用百分比 |

†**Math Expression:** `m1/bandwidth*100` where m1=ConnectionBpsIngress or ConnectionBpsEgress. Bandwidth is auto-detected from the AWS Direct Connect API (`describe_connections`).

---

## Common Alarm Settings

| Setting | Value |
|---------|-------|
| Period | 300 seconds (5 minutes) |
| EvaluationPeriods | 2 consecutive periods |
| TreatMissingData | notBreaching |
| Statistic | MAX (via Metrics Insights SQL or MetricStat) |

---

## References

- [CloudWatch Best Practice Alarms](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Best_Practice_Recommended_Alarms_AWS_Services.html)
- [CloudWatch Metrics Insights](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/query_with_cloudwatch-metrics-insights.html)
- [CloudWatch Agent Installation](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Install-CloudWatch-Agent.html)
- [MSK Monitoring](https://docs.aws.amazon.com/msk/latest/developerguide/monitoring.html)
- [Direct Connect Monitoring](https://docs.aws.amazon.com/directconnect/latest/UserGuide/monitoring-cloudwatch.html)
- [ACM Monitoring](https://docs.aws.amazon.com/acm/latest/userguide/cloudwatch-metrics.html)
